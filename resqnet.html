<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ResQNet — Secure D2D Simulator</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* keep your local node layout styles, plus small styles for new path-table & controls */
    .net-stage {
      position: relative;
      width: 100%;
      height: 420px;
      background: rgba(0, 40, 40, 0.06);
      border-radius: 10px;
      overflow: hidden;
    }
    .node {
      position: absolute;
      width: 62px;
      height: 62px;
      border-radius: 50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      cursor:pointer;
      user-select:none;
      background: linear-gradient(145deg, #0ae3d8, #065e63);
      color: #042d31;
      box-shadow: 0 4px 14px rgba(0,255,255,0.12);
      transition: transform 0.18s ease, box-shadow 0.18s ease;
    }
    .node:hover { transform: scale(1.06); box-shadow: 0 10px 24px rgba(0,255,255,0.16); }
    #nodeA { left: 8%; top: 8%; }
    #nodeB { left: 44%; top: 8%; transform: translateX(-50%); }
    #nodeC { right: 8%; top: 8%; }
    #nodeD { left: 8%; top: 44%; transform: translateY(-50%); }
    #nodeE { left: 44%; top: 44%; transform: translate(-50%,-50%); }
    #nodeF { right: 8%; top: 44%; transform: translateY(-50%); }
    #nodeG { left: 8%; bottom: 8%; }
    #nodeH { left: 44%; bottom: 8%; transform: translateX(-50%); }
    #nodeI { right: 8%; bottom: 8%; }

    .packet-label {
      pointer-events: none;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 6px;
      white-space: nowrap;
      transform: translate(-50%, -100%);
      background: #e3fffe;
      color: #052024;
      z-index: 1000;
      position: absolute;
    }

    /* New path table & actions (styled to match existing log) */
    .path-panel {
      margin-top: 14px;
      background: rgba(255,255,255,0.02);
      padding: 0.7rem;
      border-radius: 10px;
      width: 100%;
    }
    #pathTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      min-width: 600px;
    }
    #pathTable th, #pathTable td {
      padding: 0.45rem 0.5rem;
      border-bottom: 1px dashed rgba(255,255,255,0.03);
      color: #dffbfb;
      text-align: left;
    }
    #pathTable th {
      position: sticky;
      top: 0;
      background: rgba(255,255,255,0.03);
    }

    .table-controls {
      display:flex;
      gap:10px;
      margin-top:8px;
      align-items:center;
    }
    .table-controls button {
      background-color: #00f0ff;
      color: #002022;
      font-weight: 700;
      border: 2px solid #00e6e6;
      border-radius: 8px;
      padding: 0.5rem 0.8rem;
      cursor: pointer;
    }
    .table-controls button:hover { transform: scale(1.03); }

    /* small responsive tweak */
    @media (max-width:980px) {
      .path-panel { overflow-x:auto; }
    }
  </style>
</head>
<body>
  <nav>
    <h1>ResQNet</h1>
    <a href="project.html" class="nav-btn">← Back to Project</a>
  </nav>

  <main class="sim-page">
    <div class="sim-panel card">
      <h2>ResQNet Secure D2D Communication Simulator</h2>
      <p class="subtitle">Demonstration: encrypted message transfer across a mesh network</p>

      <div class="sim-grid" style="display:flex;gap:20px;flex-wrap:wrap;">
        <!-- NETWORK PANEL -->
        <div class="network-panel" style="flex:1;min-width:420px;">
          <div class="net-stage" id="net-stage">
            <!-- 9 Node elements -->
            <div class="node" id="nodeA" data-label="Node A">A</div>
            <div class="node" id="nodeB" data-label="Node B">B</div>
            <div class="node" id="nodeC" data-label="Node C">C</div>
            <div class="node" id="nodeD" data-label="Node D">D</div>
            <div class="node" id="nodeE" data-label="Node E">E</div>
            <div class="node" id="nodeF" data-label="Node F">F</div>
            <div class="node" id="nodeG" data-label="Node G">G</div>
            <div class="node" id="nodeH" data-label="Node H">H</div>
            <div class="node" id="nodeI" data-label="Node I">I</div>
          </div>

          <div class="legend">
            <small>Nodes represent devices/field units. Lines show mesh connectivity.</small>
          </div>

          <!-- Path followed panel (new) -->
          <div class="path-panel">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <h4 style="margin:0;color:#cfeff0;">Path Followed</h4>
              <div class="table-controls">
                <button id="downloadPath">Download Path Log (CSV)</button>
                <button id="clearPath">Clear Path Log</button>
              </div>
            </div>
            <div style="max-height:220px;overflow:auto;">
              <table id="pathTable">
                <thead>
                  <tr><th>Packet ID</th><th>Source</th><th>Destination</th><th>Path</th><th>Timestamp</th></tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- CONTROL / LOG PANEL -->
        <div class="control-panel" style="width:420px;">
          <div class="controls" style="display:flex;flex-direction:column;gap:8px;">
            <label>Sender
              <select id="senderSelect">
                <option value="">Select Sender</option>
                <option value="nodeA">Node A</option>
                <option value="nodeB">Node B</option>
                <option value="nodeC">Node C</option>
                <option value="nodeD">Node D</option>
                <option value="nodeE">Node E</option>
                <option value="nodeF">Node F</option>
                <option value="nodeG">Node G</option>
                <option value="nodeH">Node H</option>
                <option value="nodeI">Node I</option>
              </select>
            </label>

            <label>Receiver
              <select id="receiverSelect">
                <option value="">Select Receiver</option>
                <option value="BROADCAST">BROADCAST (All Nodes)</option>
                <option value="nodeA">Node A</option>
                <option value="nodeB">Node B</option>
                <option value="nodeC">Node C</option>
                <option value="nodeD">Node D</option>
                <option value="nodeE">Node E</option>
                <option value="nodeF">Node F</option>
                <option value="nodeG">Node G</option>
                <option value="nodeH">Node H</option>
                <option value="nodeI">Node I</option>
              </select>
            </label>

            <label>Passphrase
              <input id="passphrase" type="text" value="ResQNetKey2025" />
              <small class="muted">Shared key (for demo). Change to simulate different sessions.</small>
            </label>

            <label>Message
              <input id="messageInput" type="text" placeholder="Type message e.g. HELP" />
            </label>

            <button id="sendBtn" class="demo-btn">Send Secure Message</button>

            <div class="encryption-output">
              <p><b>Encrypted (base64):</b></p>
              <textarea id="encryptedText" readonly rows="3" style="width:100%"></textarea>
              <p><b>Decrypted at Receiver:</b> <span id="decryptedText">—</span></p>
            </div>
          </div>

          <div class="log" style="margin-top:12px;">
            <h4>Message Log</h4>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
              <div style="font-size:0.9rem;color:#cfeff0;">Recent messages</div>
              <div style="display:flex;gap:8px;">
                <button id="downloadMsg" class="demo-btn" style="padding:0.4rem 0.7rem;">Download Log (CSV)</button>
                <button id="clearMsg" class="demo-btn" style="padding:0.4rem 0.7rem;">Clear Log</button>
              </div>
            </div>
            <div style="max-height:220px;overflow:auto;">
            <table id="logTable" style="width:100%;border-collapse:collapse;">
              <thead>
                <tr><th>Time</th><th>Sender</th><th>Receiver</th><th>Encrypted</th><th>Decrypted</th><th>Status</th></tr>
              </thead>
              <tbody></tbody>
            </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>© 2025 ResQNet | VIT Chennai</p>
  </footer>

  <script src="script.js"></script>
</body>
</html>
